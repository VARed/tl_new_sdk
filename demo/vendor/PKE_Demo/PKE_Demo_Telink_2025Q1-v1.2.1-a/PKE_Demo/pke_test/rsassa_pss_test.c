/*! @file rsassa_pss_test.c */
#include <stdio.h>

#include "lib/include/pke/pke_config.h"

#ifdef SUPPORT_RSASSA_PSS

#include "../../crypto_include/crypto_common/utility.h"
#include "../../crypto_include/pke/rsa.h"
#include "../../crypto_include/trng/trng.h"

/**
 * @brief           Main function to test RSA PSS functionality
 * @return          0 if all tests pass, 1 if any test fails
 */
unsigned int rsassa_pss_test(void)
{
    unsigned char n[] = {
        0x92,
        0x92,
        0x75,
        0x84,
        0x53,
        0x06,
        0x3D,
        0x80,
        0x3D,
        0xD6,
        0x03,
        0xD5,
        0xE7,
        0x77,
        0xD7,
        0x88,
        0x8E,
        0xD1,
        0xD5,
        0xBF,
        0x35,
        0x78,
        0x61,
        0x90,
        0xFA,
        0x2F,
        0x23,
        0xEB,
        0xC0,
        0x84,
        0x8A,
        0xEA,
        0xDD,
        0xA9,
        0x2C,
        0xA6,
        0xC3,
        0xD8,
        0x0B,
        0x32,
        0xC4,
        0xD1,
        0x09,
        0xBE,
        0x0F,
        0x36,
        0xD6,
        0xAE,
        0x71,
        0x30,
        0xB9,
        0xCE,
        0xD7,
        0xAC,
        0xDF,
        0x54,
        0xCF,
        0xC7,
        0x55,
        0x5A,
        0xC1,
        0x4E,
        0xEB,
        0xAB,
        0x93,
        0xA8,
        0x98,
        0x13,
        0xFB,
        0xF3,
        0xC4,
        0xF8,
        0x06,
        0x6D,
        0x2D,
        0x80,
        0x0F,
        0x7C,
        0x38,
        0xA8,
        0x1A,
        0xE3,
        0x19,
        0x42,
        0x91,
        0x74,
        0x03,
        0xFF,
        0x49,
        0x46,
        0xB0,
        0xA8,
        0x3D,
        0x3D,
        0x3E,
        0x05,
        0xEE,
        0x57,
        0xC6,
        0xF5,
        0xF5,
        0x60,
        0x6F,
        0xB5,
        0xD4,
        0xBC,
        0x6C,
        0xD3,
        0x4E,
        0xE0,
        0x80,
        0x1A,
        0x5E,
        0x94,
        0xBB,
        0x77,
        0xB0,
        0x75,
        0x07,
        0x23,
        0x3A,
        0x0B,
        0xC7,
        0xBA,
        0xC8,
        0xF9,
        0x0F,
        0x79,
    };
    unsigned char e[] = {
        0x01,
        0x00,
        0x01,
    };
    unsigned char d[] = {
        0x24,
        0xBF,
        0x61,
        0x85,
        0x46,
        0x87,
        0x86,
        0xFD,
        0xD3,
        0x03,
        0x08,
        0x3D,
        0x25,
        0xE6,
        0x4E,
        0xFC,
        0x66,
        0xCA,
        0x47,
        0x2B,
        0xC4,
        0x4D,
        0x25,
        0x31,
        0x02,
        0xF8,
        0xB4,
        0xA9,
        0xD3,
        0xBF,
        0xA7,
        0x50,
        0x91,
        0x38,
        0x6C,
        0x00,
        0x77,
        0x93,
        0x7F,
        0xE3,
        0x3F,
        0xA3,
        0x25,
        0x2D,
        0x28,
        0x85,
        0x58,
        0x37,
        0xAE,
        0x1B,
        0x48,
        0x4A,
        0x8A,
        0x9A,
        0x45,
        0xF7,
        0xEE,
        0x8C,
        0x0C,
        0x63,
        0x4F,
        0x99,
        0xE8,
        0xCD,
        0xDF,
        0x79,
        0xC5,
        0xCE,
        0x07,
        0xEE,
        0x72,
        0xC7,
        0xF1,
        0x23,
        0x14,
        0x21,
        0x98,
        0x16,
        0x42,
        0x34,
        0xCA,
        0xBB,
        0x72,
        0x4C,
        0xF7,
        0x8B,
        0x81,
        0x73,
        0xB9,
        0xF8,
        0x80,
        0xFC,
        0x86,
        0x32,
        0x24,
        0x07,
        0xAF,
        0x1F,
        0xED,
        0xFD,
        0xDE,
        0x2B,
        0xEB,
        0x67,
        0x4C,
        0xA1,
        0x5F,
        0x3E,
        0x81,
        0xA1,
        0x52,
        0x1E,
        0x07,
        0x15,
        0x13,
        0xA1,
        0xE8,
        0x5B,
        0x5D,
        0xFA,
        0x03,
        0x1F,
        0x21,
        0xEC,
        0xAE,
        0x91,
        0xA3,
        0x4D,
    };
    unsigned char p[] = {
        0xC3,
        0x6D,
        0x0E,
        0xB7,
        0xFC,
        0xD2,
        0x85,
        0x22,
        0x3C,
        0xFB,
        0x5A,
        0xAB,
        0xA5,
        0xBD,
        0xA3,
        0xD8,
        0x2C,
        0x01,
        0xCA,
        0xD1,
        0x9E,
        0xA4,
        0x84,
        0xA8,
        0x7E,
        0xA4,
        0x37,
        0x76,
        0x37,
        0xE7,
        0x55,
        0x00,
        0xFC,
        0xB2,
        0x00,
        0x5C,
        0x5C,
        0x7D,
        0xD6,
        0xEC,
        0x4A,
        0xC0,
        0x23,
        0xCD,
        0xA2,
        0x85,
        0xD7,
        0x96,
        0xC3,
        0xD9,
        0xE7,
        0x5E,
        0x1E,
        0xFC,
        0x42,
        0x48,
        0x8B,
        0xB4,
        0xF1,
        0xD1,
        0x3A,
        0xC3,
        0x0A,
        0x57,
    };
    unsigned char q[] = {
        0xC0,
        0x00,
        0xDF,
        0x51,
        0xA7,
        0xC7,
        0x7A,
        0xE8,
        0xD7,
        0xC7,
        0x37,
        0x0C,
        0x1F,
        0xF5,
        0x5B,
        0x69,
        0xE2,
        0x11,
        0xC2,
        0xB9,
        0xE5,
        0xDB,
        0x1E,
        0xD0,
        0xBF,
        0x61,
        0xD0,
        0xD9,
        0x89,
        0x96,
        0x20,
        0xF4,
        0x91,
        0x0E,
        0x41,
        0x68,
        0x38,
        0x7E,
        0x3C,
        0x30,
        0xAA,
        0x1E,
        0x00,
        0xC3,
        0x39,
        0xA7,
        0x95,
        0x08,
        0x84,
        0x52,
        0xDD,
        0x96,
        0xA9,
        0xA5,
        0xEA,
        0x5D,
        0x9D,
        0xCA,
        0x68,
        0xDA,
        0x63,
        0x60,
        0x32,
        0xAF,
    };
    unsigned char dp[] = {
        0xC1,
        0xAC,
        0xF5,
        0x67,
        0x56,
        0x42,
        0x74,
        0xFB,
        0x07,
        0xA0,
        0xBB,
        0xAD,
        0x5D,
        0x26,
        0xE2,
        0x98,
        0x3C,
        0x94,
        0xD2,
        0x22,
        0x88,
        0xAC,
        0xD7,
        0x63,
        0xFD,
        0x8E,
        0x56,
        0x00,
        0xED,
        0x4A,
        0x70,
        0x2D,
        0xF8,
        0x41,
        0x98,
        0xA5,
        0xF0,
        0x6C,
        0x2E,
        0x72,
        0x23,
        0x6A,
        0xE4,
        0x90,
        0xC9,
        0x3F,
        0x07,
        0xF8,
        0x3C,
        0xC5,
        0x59,
        0xCD,
        0x27,
        0xBC,
        0x2D,
        0x1C,
        0xA4,
        0x88,
        0x81,
        0x17,
        0x30,
        0xBB,
        0x57,
        0x25,
    };
    unsigned char dq[] = {
        0x49,
        0x59,
        0xCB,
        0xF6,
        0xF8,
        0xFE,
        0xF7,
        0x50,
        0xAE,
        0xE6,
        0x97,
        0x7C,
        0x15,
        0x55,
        0x79,
        0xC7,
        0xD8,
        0xAA,
        0xEA,
        0x56,
        0x74,
        0x9E,
        0xA2,
        0x86,
        0x23,
        0x27,
        0x2E,
        0x4F,
        0x7D,
        0x05,
        0x92,
        0xAF,
        0x7C,
        0x1F,
        0x13,
        0x13,
        0xCA,
        0xC9,
        0x47,
        0x1B,
        0x5C,
        0x52,
        0x3B,
        0xFE,
        0x59,
        0x2F,
        0x51,
        0x7B,
        0x40,
        0x7A,
        0x1B,
        0xD7,
        0x6C,
        0x16,
        0x4B,
        0x93,
        0xDA,
        0x2D,
        0x32,
        0xA3,
        0x83,
        0xE5,
        0x83,
        0x57,
    };
    unsigned char u[] = {
        0x9A,
        0xE7,
        0xFB,
        0xC9,
        0x95,
        0x46,
        0x43,
        0x2D,
        0xF7,
        0x18,
        0x96,
        0xFC,
        0x23,
        0x9E,
        0xAD,
        0xAE,
        0xF3,
        0x8D,
        0x18,
        0xD2,
        0xB2,
        0xF0,
        0xE2,
        0xDD,
        0x27,
        0x5A,
        0xA9,
        0x77,
        0xE2,
        0xBF,
        0x44,
        0x11,
        0xF5,
        0xA3,
        0xB2,
        0xA5,
        0xD3,
        0x36,
        0x05,
        0xAE,
        0xBB,
        0xCC,
        0xBA,
        0x7F,
        0xEB,
        0x9F,
        0x2D,
        0x2F,
        0xA7,
        0x42,
        0x06,
        0xCE,
        0xC1,
        0x69,
        0xD7,
        0x4B,
        0xF5,
        0xA8,
        0xC5,
        0x0D,
        0x6F,
        0x48,
        0xEA,
        0x08,
    };
    unsigned char msg[] = {
        0xAA,
        0xBB,
        0xCC,
        0x03,
        0x02,
        0x01,
        0x00,
        0xFF,
        0xFF,
        0xFF,
        0xFF,
        0xFF,
        0x11,
        0x22,
        0x33,
        0x0A,
        0x0B,
        0x0C,
        0xCC,
        0xDD,
        0xDD,
        0xDD,
        0xDD,
        0xDD,
    };
    unsigned int msg_len = sizeof(msg);
    unsigned char salt_max[62] = {0xD9, 0x23, 0xD1, 0x55, 0x90, 0x38, 0x28, 0xD1, 0xD9, 0x6C, 0xA1, 0x66, 0x5E, 0x4E, 0xE1, 0x30, 0x9C, 0xFE, 0xD9, 0x71, 0x9F,
                                  0xE2, 0xA5, 0xE2, 0x0C, 0x9B, 0xB4, 0x47, 0x65, 0x38, 0x2A, 0x46, 0x89, 0xA9, 0x82, 0x79, 0x7A, 0x76, 0x78, 0xC2, 0x63, 0xB1,
                                  0x26, 0xDF, 0xDA, 0x29, 0x6D, 0x3E, 0x62, 0xE0, 0x96, 0x12, 0x34, 0xBF, 0x39, 0xA6, 0x3F, 0x89, 0x5E, 0xF1, 0x6D, 0x0E};
    unsigned char *salt_1 = salt_max;

    unsigned char signature_salt_max[] = {
        0x1E,
        0xD7,
        0x3F,
        0x91,
        0x34,
        0x2D,
        0xDE,
        0x75,
        0xA1,
        0x75,
        0x3F,
        0x8A,
        0x1F,
        0x21,
        0xD9,
        0xF0,
        0xEA,
        0x55,
        0xED,
        0xA2,
        0x6D,
        0x5C,
        0xCD,
        0xB1,
        0xCA,
        0xCA,
        0x8E,
        0x6A,
        0x65,
        0x56,
        0xEC,
        0xAC,
        0x9C,
        0x94,
        0x90,
        0xDC,
        0xD7,
        0x86,
        0xF5,
        0xF3,
        0x67,
        0x75,
        0xB6,
        0xC9,
        0x56,
        0xFD,
        0x71,
        0x86,
        0x94,
        0x74,
        0xF6,
        0xBD,
        0x8C,
        0xC4,
        0x90,
        0xDF,
        0xAA,
        0x1F,
        0x4E,
        0x19,
        0x47,
        0xD9,
        0xEF,
        0x06,
        0x8C,
        0xC1,
        0xB2,
        0x4D,
        0x09,
        0xDF,
        0x8E,
        0xC2,
        0x85,
        0x30,
        0xAE,
        0xD9,
        0x9D,
        0x9A,
        0x01,
        0x1E,
        0xE7,
        0xF2,
        0x32,
        0x99,
        0xFF,
        0xF3,
        0x15,
        0x28,
        0x58,
        0x11,
        0x74,
        0xD8,
        0x18,
        0x84,
        0xC9,
        0xBF,
        0x8C,
        0x6A,
        0xDC,
        0x8A,
        0xCF,
        0x0E,
        0xCB,
        0x59,
        0x78,
        0x56,
        0xC4,
        0x47,
        0x8F,
        0x13,
        0xAF,
        0x9D,
        0x56,
        0x17,
        0x66,
        0x6D,
        0xBC,
        0x02,
        0xF1,
        0x80,
        0x28,
        0x9F,
        0x13,
        0x6C,
        0xB3,
        0xEC,
        0x34,
        0x0D,
    };
    unsigned char signature_salt_1[] = {
        0x1D,
        0x3C,
        0x70,
        0xE1,
        0xF8,
        0xB8,
        0x7D,
        0xE8,
        0x09,
        0xF7,
        0x0B,
        0x55,
        0x2E,
        0x68,
        0x8A,
        0x01,
        0x20,
        0x41,
        0x6D,
        0xDC,
        0x2E,
        0x19,
        0xCD,
        0x7F,
        0xF8,
        0x6F,
        0x69,
        0x42,
        0xDD,
        0xEF,
        0x1F,
        0xA0,
        0x23,
        0xB2,
        0x5A,
        0x04,
        0xFB,
        0x2B,
        0xED,
        0x9C,
        0x04,
        0x29,
        0xC1,
        0x6F,
        0x86,
        0x39,
        0x19,
        0x1E,
        0xE0,
        0xC6,
        0x6D,
        0x3B,
        0x1B,
        0x60,
        0x33,
        0x31,
        0xF1,
        0x25,
        0x07,
        0x5B,
        0xF2,
        0x25,
        0x12,
        0x0A,
        0xFD,
        0x91,
        0xBA,
        0x6D,
        0xD8,
        0xF8,
        0xED,
        0x9F,
        0xAC,
        0xAC,
        0xD7,
        0x20,
        0x8E,
        0x91,
        0x3F,
        0xE7,
        0xA8,
        0xD0,
        0xC0,
        0xDD,
        0x63,
        0xE7,
        0xDA,
        0x2B,
        0xF2,
        0xC7,
        0x71,
        0x07,
        0xD0,
        0x7D,
        0xAD,
        0x9B,
        0x69,
        0x90,
        0xBD,
        0xA6,
        0xFE,
        0xF4,
        0x71,
        0xC4,
        0xE8,
        0xE9,
        0x85,
        0x2E,
        0x76,
        0x1F,
        0x79,
        0x3B,
        0xA5,
        0x2A,
        0x19,
        0x80,
        0xFB,
        0xF5,
        0x32,
        0x77,
        0xF9,
        0xD6,
        0xE4,
        0x2B,
        0x28,
        0xBC,
        0x9F,
        0x5A,
    };
    unsigned char signature_salt_0[] = {
        0x03,
        0x3E,
        0x42,
        0x62,
        0xD1,
        0xD0,
        0x0B,
        0xC8,
        0xEE,
        0x5F,
        0x59,
        0xD8,
        0xB5,
        0x84,
        0xDC,
        0x3E,
        0xCB,
        0xDD,
        0xA7,
        0x2B,
        0xA4,
        0x62,
        0xF4,
        0x80,
        0x87,
        0x95,
        0xF4,
        0x76,
        0x41,
        0x21,
        0x3B,
        0x9A,
        0x4A,
        0xF9,
        0x82,
        0x33,
        0xD2,
        0xA5,
        0x8F,
        0x03,
        0x9B,
        0x6A,
        0x55,
        0xE8,
        0x7A,
        0x40,
        0x34,
        0xF7,
        0xC0,
        0x18,
        0xB2,
        0xE8,
        0x0A,
        0x9D,
        0xFF,
        0x64,
        0x6D,
        0xE3,
        0xB7,
        0x6B,
        0xD4,
        0x18,
        0x27,
        0xDF,
        0xA3,
        0xCA,
        0x97,
        0x22,
        0x1E,
        0xA4,
        0x7F,
        0x2D,
        0x7D,
        0xED,
        0xE1,
        0x74,
        0xCA,
        0x30,
        0x25,
        0xB6,
        0x4B,
        0x65,
        0xDE,
        0x4E,
        0x60,
        0x56,
        0x22,
        0x50,
        0x88,
        0xB6,
        0x0F,
        0xEE,
        0x5A,
        0xC5,
        0x95,
        0x71,
        0x6B,
        0x32,
        0x6C,
        0x0C,
        0xF2,
        0x37,
        0x7D,
        0x45,
        0xA2,
        0x3B,
        0x87,
        0x86,
        0x54,
        0xC1,
        0xA0,
        0xF5,
        0xD6,
        0xA9,
        0x06,
        0xAE,
        0x32,
        0x44,
        0x25,
        0xF2,
        0x7D,
        0x7A,
        0x5C,
        0x99,
        0x9C,
        0x55,
        0x95,
        0x17,
    };
    unsigned char signature[1024 / 8];
    unsigned int n_bitLen = 1024, e_bitLen = 17;
    unsigned int n_byteLen = get_byte_len(n_bitLen);
    unsigned int salt_bytes_max = 62; // this is 128-64-2, the max value.
    unsigned int salt_bytes_1 = 1;
    unsigned int i, ret;
    rsa_crt_private_key_t rsa_crt_pri_key[1] = {
        {p, q, dp, dq, u},
    };

    // salt is of max length(this standard data is from mbedtls)

    /********************** salt is of max length(this standard data is from
     * mbedtls) ********************** msg_digest(mhash):
     *   9dd016a86e0b360f6a4a35e6a080ace1d52433c4944f2db6c028cb6f7890bce3fdbbcc236a53bd38670c6810d4b70b68cf55c39e9b61fb66801aa1ee40b27214
     * salt:
     *   d923d155903828d1d96ca1665e4ee1309cfed9719fe2a5e20c9bb44765382a4689a982797a7678c263b126dfda296d3e62e0961234bf39a63f895ef16d0e
     * H(M'): here M' = H(padding1||mhash||salt)
     *   3C9602FA049E266D99558D73FFEBE322EE892897EDC376916467B355D279361940D1963C9FB85E5AEC9AB268E9453362DA0698B9FC10236F13FE0A24832BB92C
     * DB:
     *   01d923d155903828d1d96ca1665e4ee1309cfed9719fe2a5e20c9bb44765382a4689a982797a7678c263b126dfda296d3e62e0961234bf39a63f895ef16d0e
     * MGF1(H(M')):
     *   1352F324BBF3A29AA6182C03B57A5C4ED83556D06F8121856521398B5CAFBA8E20C60EC7AC1EB7CD3E9F8803587F7EBBF3A35E99C2926E757BB7EA2E9316FA
     * maskDB:
     *   128bd0f5ee639ab277c140a2d32412afe8a9a8091e1ec320872da23f1bca82a4664fa745d564c1b5fcfc392587a557d6cdc1be0fd0a6d14cdd886370627bf4
     * em:
     *   128bd0f5ee639ab277c140a2d32412afe8a9a8091e1ec320872da23f1bca82a4664fa745d564c1b5fcfc392587a557d6cdc1be0fd0a6d14cdd886370627bf43C
     *   9602FA049E266D99558D73FFEBE322EE892897EDC376916467B355D279361940D1963C9FB85E5AEC9AB268E9453362DA0698B9FC10236F13FE0A24832BB92CBC
     */
    ret = rsa_ssa_pss_sign(HASH_SHA512, HASH_SHA512, salt_max, salt_bytes_max, msg, msg_len, d, n, n_bitLen, signature);
    if ((RSA_SUCCESS != ret) || (memcmp_(signature, signature_salt_max, n_byteLen)))
    {
        printf("\r\nrsa_ssa_pss_sign error 1! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\nrsa_ssa_pss_sign success 1");
    }

    memset_(signature, 0, sizeof(signature));
    ret = rsa_ssa_pss_crt_sign(HASH_SHA512, HASH_SHA512, salt_max, salt_bytes_max, msg, msg_len, rsa_crt_pri_key, n_bitLen, signature);
    if ((RSA_SUCCESS != ret) || (memcmp_(signature, signature_salt_max, n_byteLen)))
    {
        printf("\r\rsa_ssa_pss_crt_sign error 1! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\rsa_ssa_pss_crt_sign success 1");
    }

    ret = rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, salt_bytes_max, msg, msg_len, e, e_bitLen, n, n_bitLen, signature_salt_max);
    ret |= rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, -1, msg, msg_len, e, e_bitLen, n, n_bitLen, signature_salt_max);
    if (RSA_SUCCESS != ret)
    {
        printf("\r\nrsa_ssa_pss_verify error 1! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\nrsa_ssa_pss_verify success 1");
    }

    /********************** salt is 1 byte **********************
     * msg_digest(mhash):
     *  9dd016a86e0b360f6a4a35e6a080ace1d52433c4944f2db6c028cb6f7890bce3fdbbcc236a53bd38670c6810d4b70b68cf55c39e9b61fb66801aa1ee40b27214
     * salt: d9
     * H(M'): here M' = H(padding1||mhash||salt)
     *  3CBB1299D556AB46D1C2640588D84A014BF314DE9D0C7F0D7B1C19B81CECF3641C6E06761F1B380D6977B22887BF5C4720FC77354008A1D1887CDF349897767A
     * DB:
     *  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001D9
     * MGF1(H(M')):
     *  E1B84DCEE5D055FCEDD61355E90DB710DE226DCFC93586A6F87795F8A6BF261C215D6E6034B1B10426FDAEAAECA884B0C68F1F744CFA352364593B2BB6950D
     * maskDB:
     *  61B84DCEE5D055FCEDD61355E90DB710DE226DCFC93586A6F87795F8A6BF261C215D6E6034B1B10426FDAEAAECA884B0C68F1F744CFA352364593B2BB694D4
     * em:
     *  61B84DCEE5D055FCEDD61355E90DB710DE226DCFC93586A6F87795F8A6BF261C215D6E6034B1B10426FDAEAAECA884B0C68F1F744CFA352364593B2BB694D43C
     *  BB1299D556AB46D1C2640588D84A014BF314DE9D0C7F0D7B1C19B81CECF3641C6E06761F1B380D6977B22887BF5C4720FC77354008A1D1887CDF349897767ABC
     */
    ret = rsa_ssa_pss_sign(HASH_SHA512, HASH_SHA512, salt_1, salt_bytes_1, msg, msg_len, d, n, n_bitLen, signature);
    if ((RSA_SUCCESS != ret) || (memcmp_(signature, signature_salt_1, n_byteLen)))
    {
        printf("\r\nrsa_ssa_pss_sign error 2! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\nrsa_ssa_pss_sign success 2");
    }

    memset_(signature, 0, sizeof(signature));
    ret = rsa_ssa_pss_crt_sign(HASH_SHA512, HASH_SHA512, salt_1, salt_bytes_1, msg, msg_len, rsa_crt_pri_key, n_bitLen, signature);
    if ((RSA_SUCCESS != ret) || (memcmp_(signature, signature_salt_1, n_byteLen)))
    {
        printf("\r\rsa_ssa_pss_crt_sign error 2! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\rsa_ssa_pss_crt_sign success 2");
    }

    ret = rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, salt_bytes_1, msg, msg_len, e, e_bitLen, n, n_bitLen, signature_salt_1);
    ret |= rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, -1, msg, msg_len, e, e_bitLen, n, n_bitLen, signature_salt_1);
    if (RSA_SUCCESS != ret)
    {
        printf("\r\nrsa_ssa_pss_verify error 2! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\nrsa_ssa_pss_verify success 2");
    }

    /********************** salt is 0 byte **********************
     * msg_digest(mhash):
     *  9dd016a86e0b360f6a4a35e6a080ace1d52433c4944f2db6c028cb6f7890bce3fdbbcc236a53bd38670c6810d4b70b68cf55c39e9b61fb66801aa1ee40b27214
     * salt: none
     * H(M'): here M' = H(padding1||mhash||salt)
     *  B941DC421ED9D04492E86119894F258FF758B0D66BDAD48241491285FAB44342AF4562689C0396CE20C342FC1CA6D4275F2E0A8CB70AE07FAEAEF743EAB994BB
     * DB:
     *  000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001
     * MGF1(H(M')):
     *  807AAC4F1648CC65A7D141FE5A734975DB616AEF3E3EE46DECE5C9A6EEDE92959C2AEB9677DC1A1701C90F7975FD6E2EFD3DA85B792C3FAFEF0D6F7CE3B64D
     * maskDB:
     *  007AAC4F1648CC65A7D141FE5A734975DB616AEF3E3EE46DECE5C9A6EEDE92959C2AEB9677DC1A1701C90F7975FD6E2EFD3DA85B792C3FAFEF0D6F7CE3B64C
     * em:
     *  007AAC4F1648CC65A7D141FE5A734975DB616AEF3E3EE46DECE5C9A6EEDE92959C2AEB9677DC1A1701C90F7975FD6E2EFD3DA85B792C3FAFEF0D6F7CE3B64CB9
     *  41DC421ED9D04492E86119894F258FF758B0D66BDAD48241491285FAB44342AF4562689C0396CE20C342FC1CA6D4275F2E0A8CB70AE07FAEAEF743EAB994BBBC
     */
    ret = rsa_ssa_pss_sign(HASH_SHA512, HASH_SHA512, salt_1, 0, msg, msg_len, d, n, n_bitLen, signature);
    if ((RSA_SUCCESS != ret) || (memcmp_(signature, signature_salt_0, n_byteLen)))
    {
        printf("\r\nrsa_ssa_pss_sign error 3! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\nrsa_ssa_pss_sign success 3");
    }

    memset_(signature, 0, sizeof(signature));
    ret = rsa_ssa_pss_crt_sign(HASH_SHA512, HASH_SHA512, salt_1, 0, msg, msg_len, rsa_crt_pri_key, n_bitLen, signature);
    if ((RSA_SUCCESS != ret) || (memcmp_(signature, signature_salt_0, n_byteLen)))
    {
        printf("\r\rsa_ssa_pss_crt_sign error 3! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\rsa_ssa_pss_crt_sign success 3");
    }

    ret = rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, 0, msg, msg_len, e, e_bitLen, n, n_bitLen, signature_salt_0);
    ret |= rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, -1, msg, msg_len, e, e_bitLen, n, n_bitLen, signature_salt_0);
    if (RSA_SUCCESS != ret)
    {
        printf("\r\nrsa_ssa_pss_verify error 3! ret=%x", ret);
        return 1;
    }
    else
    {
        printf("\r\nrsa_ssa_pss_verify success 3");
    }

    printf("\r\n");
    for (i = 0; i <= salt_bytes_max; i++)
    {
        ret = rsa_ssa_pss_sign(HASH_SHA512, HASH_SHA512, NULL, i, msg, msg_len, d, n, n_bitLen, signature);
        if (RSA_SUCCESS != ret)
        {
            printf("\r\nrsa_ssa_pss_sign error 4-%u! ret=%x", i, ret);
            return 1;
        }
        else
        {
            ;
        }

        memset_(signature, 0, sizeof(signature));
        ret = rsa_ssa_pss_crt_sign(HASH_SHA512, HASH_SHA512, NULL, i, msg, msg_len, rsa_crt_pri_key, n_bitLen, signature);
        if (RSA_SUCCESS != ret)
        {
            printf("\r\rsa_ssa_pss_crt_sign error 4-%u! ret=%x", i, ret);
            return 1;
        }
        else
        {
            ;
        }

        ret = rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, i, msg, msg_len, e, e_bitLen, n, n_bitLen, signature);
        ret |= rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, -1, msg, msg_len, e, e_bitLen, n, n_bitLen, signature);
        if (RSA_SUCCESS != ret)
        {
            printf("\r\nrsa_ssa_pss_verify error 4-%u! ret=%x", i, ret);
            return 1;
        }
        else
        {
            ;
        }

        printf(" %u", i);
        fflush(stdout);
    }

    printf("\r\n");
    for (i = 0; i <= 128 - 1 - 32 - 1; i++)
    {
        ret = rsa_ssa_pss_sign(HASH_SM3, HASH_SM3, NULL, i, msg, msg_len, d, n, n_bitLen, signature);
        if (RSA_SUCCESS != ret)
        {
            printf("\r\nrsa_ssa_pss_sign error 4-%u! ret=%x", i, ret);
            return 1;
        }
        else
        {
            ;
        }

        ret = rsa_ssa_pss_verify(HASH_SM3, HASH_SM3, i, msg, msg_len, e, e_bitLen, n, n_bitLen, signature);
        ret |= rsa_ssa_pss_verify(HASH_SM3, HASH_SM3, -1, msg, msg_len, e, e_bitLen, n, n_bitLen, signature);
        if (RSA_SUCCESS != ret)
        {
            printf("\r\nrsa_ssa_pss_verify error 4-%u! ret=%x", i, ret);
            return 1;
        }
        else
        {
            ;
        }
        printf(" %u", i);
        fflush(stdout);
    }
    return 0;
}

/**
 * @brief           Additional test function for RSA PSS
 * @return          0 if all tests pass, 1 if any test fails
 */
unsigned int rsassa_pss_test000(void)
{
    unsigned char n[] = {
        0xCD,
        0x1A,
        0x22,
        0xC1,
        0x75,
        0xC9,
        0xED,
        0xF2,
        0x08,
        0x4E,
        0xEB,
        0x53,
        0x0A,
        0x85,
        0x71,
        0x03,
        0xA0,
        0x72,
        0x26,
        0xD5,
        0xC8,
        0xCC,
        0xB6,
        0xF6,
        0xC7,
        0x67,
        0x9D,
        0x25,
        0x3A,
        0x84,
        0x13,
        0xE0,
        0xA4,
        0x84,
        0x7A,
        0xBD,
        0xCA,
        0x94,
        0xDF,
        0xD7,
        0xA8,
        0xB9,
        0x83,
        0x32,
        0x54,
        0x83,
        0x3D,
        0xB9,
        0x1C,
        0x19,
        0x51,
        0xB8,
        0x0E,
        0x99,
        0x1E,
        0xB0,
        0x44,
        0x69,
        0x20,
        0xA8,
        0x62,
        0x3D,
        0xA8,
        0xAD,
        0x86,
        0xA6,
        0x57,
        0x97,
        0xAA,
        0x30,
        0x20,
        0xE1,
        0x6B,
        0x05,
        0xBA,
        0x5E,
        0xD6,
        0x19,
        0x4F,
        0xEC,
        0x14,
        0x91,
        0xA8,
        0xD9,
        0x2A,
        0x01,
        0xD1,
        0x71,
        0xF7,
        0x3C,
        0x05,
        0x94,
        0x4F,
        0xEA,
        0x00,
        0x07,
        0xF0,
        0x1A,
        0x23,
        0x61,
        0xA3,
        0x32,
        0xF9,
        0x5A,
        0x5E,
        0xE9,
        0x89,
        0xEC,
        0x5E,
        0x81,
        0x5C,
        0xD4,
        0xD6,
        0xE1,
        0x52,
        0x63,
        0x5D,
        0x68,
        0x46,
        0x5A,
        0x83,
        0x54,
        0x07,
        0xAE,
        0x79,
        0x20,
        0xDA,
        0x8A,
        0xE7,
        0xA2,
        0x7F,
        0xBF,
        0x4C,
        0xE6,
        0xF3,
        0x01,
        0x21,
        0xAB,
        0xFE,
        0x43,
        0xEB,
        0xC7,
        0x5C,
        0xB2,
        0xA3,
        0xA6,
        0x24,
        0x43,
        0xE8,
        0x5D,
        0x3E,
        0x12,
        0x2D,
        0x4B,
        0x0F,
        0x52,
        0x84,
        0xED,
        0x96,
        0x88,
        0xB1,
        0x08,
        0xDC,
        0x1F,
        0x94,
        0x55,
        0xF9,
        0xF0,
        0xE6,
        0x9E,
        0x20,
        0x86,
        0x8B,
        0x6F,
        0xCF,
        0x52,
        0x4C,
        0x95,
        0xAB,
        0x90,
        0xD3,
        0x82,
        0x8C,
        0xD4,
        0x06,
        0x9E,
        0xD8,
        0x47,
        0x55,
        0x0A,
        0x4C,
        0xBD,
        0x9D,
        0xC8,
        0x6A,
        0xFE,
        0x9F,
        0xF0,
        0xAD,
        0xC3,
        0xF0,
        0xA8,
        0x57,
        0x86,
        0xDA,
        0x5C,
        0x63,
        0x1F,
        0x0F,
        0x15,
        0xDE,
        0x01,
        0x81,
        0xC1,
        0x44,
        0x9B,
        0xFA,
        0x7D,
        0x8D,
        0xE2,
        0x14,
        0xF3,
        0xCD,
        0xAC,
        0x6E,
        0x95,
        0x51,
        0x3A,
        0x74,
        0x49,
        0x69,
        0xB9,
        0x88,
        0xF5,
        0xC2,
        0xC1,
        0x52,
        0xAD,
        0xE2,
        0x7B,
        0x1A,
        0x24,
        0xFA,
        0xA9,
        0x68,
        0x62,
        0x65,
        0x2C,
        0x0B,
        0xDA,
        0xE1,
        0x8E,
        0x70,
        0x1F,
        0xF9,
        0xC7,
    };
    unsigned char e[] = {
        0x01,
        0x00,
        0x01,
    };
    unsigned char d[] = {
        0x26,
        0xC2,
        0x76,
        0xA8,
        0xFA,
        0xBA,
        0x83,
        0x66,
        0x06,
        0xDD,
        0xEB,
        0x28,
        0xD1,
        0x47,
        0x30,
        0x79,
        0x4F,
        0xFB,
        0xE2,
        0x8C,
        0xEA,
        0x1A,
        0x8D,
        0xC5,
        0x0B,
        0x1F,
        0xF0,
        0x99,
        0x95,
        0x7A,
        0x5A,
        0x4B,
        0x4C,
        0xAB,
        0xE0,
        0x8A,
        0x37,
        0x5B,
        0x75,
        0x05,
        0xCB,
        0x53,
        0xEB,
        0x90,
        0x3A,
        0x5A,
        0x66,
        0xF2,
        0xB1,
        0x75,
        0xB3,
        0x74,
        0xC6,
        0x05,
        0x77,
        0xC0,
        0x35,
        0xDD,
        0x6C,
        0x17,
        0x86,
        0x21,
        0x42,
        0xDC,
        0x30,
        0x23,
        0x05,
        0x50,
        0x9B,
        0x0F,
        0xE7,
        0x56,
        0xD2,
        0x23,
        0xCD,
        0xF9,
        0x98,
        0x1A,
        0x46,
        0x79,
        0x45,
        0xD5,
        0xD5,
        0x03,
        0xDD,
        0x25,
        0x64,
        0xD0,
        0x55,
        0xB9,
        0x99,
        0x10,
        0x53,
        0x1D,
        0xD4,
        0x8D,
        0xAB,
        0x79,
        0x35,
        0x10,
        0x81,
        0x87,
        0xE3,
        0x89,
        0x89,
        0x80,
        0x36,
        0xD9,
        0x5D,
        0x6E,
        0xB2,
        0xFD,
        0x61,
        0xF2,
        0x48,
        0xE0,
        0x90,
        0x49,
        0x61,
        0x6A,
        0x3F,
        0x81,
        0x44,
        0xC6,
        0x5B,
        0x0B,
        0xB3,
        0x60,
        0xCF,
        0xE4,
        0x56,
        0x18,
        0xCB,
        0x89,
        0x76,
        0xA8,
        0x67,
        0x35,
        0x0B,
        0xFD,
        0x4C,
        0xE8,
        0x8C,
        0xF6,
        0x29,
        0x6F,
        0x8F,
        0xCE,
        0xDC,
        0x6A,
        0x56,
        0x43,
        0x81,
        0x90,
        0x9F,
        0xA7,
        0xBA,
        0xDC,
        0xD9,
        0xCB,
        0x14,
        0x0E,
        0x01,
        0xAE,
        0x44,
        0x53,
        0x62,
        0xEC,
        0x68,
        0x9F,
        0x10,
        0x3C,
        0x7C,
        0xD4,
        0xD9,
        0x21,
        0x26,
        0x29,
        0xB8,
        0x50,
        0xB0,
        0x57,
        0xB2,
        0xF8,
        0x17,
        0x83,
        0x9E,
        0x12,
        0xCE,
        0xC3,
        0x37,
        0x05,
        0xC0,
        0xFB,
        0xD9,
        0x55,
        0x55,
        0xB3,
        0x8E,
        0x89,
        0x09,
        0x03,
        0x1A,
        0x67,
        0x05,
        0x52,
        0xAF,
        0xE1,
        0x09,
        0x6C,
        0x95,
        0x4A,
        0x29,
        0xC5,
        0x27,
        0x98,
        0xDE,
        0x5B,
        0xFF,
        0x5A,
        0x46,
        0x1F,
        0x7B,
        0x13,
        0x2A,
        0x8E,
        0x42,
        0x2B,
        0xB2,
        0x83,
        0x99,
        0x8D,
        0x74,
        0x8B,
        0x50,
        0xA8,
        0x63,
        0xBA,
        0x2A,
        0x78,
        0xB7,
        0xBC,
        0xE9,
        0x41,
        0x05,
        0xF8,
        0x2C,
        0xA9,
        0x9B,
        0x6E,
        0xED,
        0xC8,
        0x1E,
        0xAE,
        0x57,
        0x99,
    };
    unsigned char in[256] = {0x01, 0x01}, out[256];
    //    unsigned int  mod_bitLen = 2048, exp_bitLen = 17;
    //    unsigned int  mod_byteLen = get_byte_len(mod_bitLen);
    //    unsigned    exp_byteLen = get_byte_len(exp_bitLen);

    unsigned int salt_bytes = 8;
    unsigned int ret;

    ret = rsa_ssa_pss_sign(HASH_SHA512, HASH_SHA512, NULL, salt_bytes, in, 100, d, n, 2048, out);
    if (RSA_SUCCESS != ret)
    {
        printf("rsa_ssa_pss_sign error! ret=%x", ret);
        return 1;
    }

    ret = rsa_ssa_pss_verify(HASH_SHA512, HASH_SHA512, salt_bytes, in, 100, e, 17, n, 2048, out);
    if (RSA_SUCCESS != ret)
    {
        printf("rsa_ssa_pss_verify error! ret=%x", ret);
        return 1;
    }

    //    print_buf_u8(e, exp_byteLen, "e");
    //    print_buf_u8(d, mod_byteLen, "d");
    //    print_buf_u8(n, mod_byteLen, "n");
    //    print_buf_u8(in, mod_byteLen, "in");
    //    pke_modexp_u8(n, e, in, out, mod_bitLen, exp_bitLen, 1);
    //    print_buf_u8(out, mod_byteLen, "out");
    //    pke_modexp_u8(n, d, out, out, mod_bitLen, mod_bitLen, 1);
    //    print_buf_u8(out, mod_byteLen, "out");

    return 0;
}

/**
 * @brief           Test function for basic RSA operations
 */
void test000(void)
{
    unsigned char n[] = {
        0xCD,
        0x1A,
        0x22,
        0xC1,
        0x75,
        0xC9,
        0xED,
        0xF2,
        0x08,
        0x4E,
        0xEB,
        0x53,
        0x0A,
        0x85,
        0x71,
        0x03,
        0xA0,
        0x72,
        0x26,
        0xD5,
        0xC8,
        0xCC,
        0xB6,
        0xF6,
        0xC7,
        0x67,
        0x9D,
        0x25,
        0x3A,
        0x84,
        0x13,
        0xE0,
        0xA4,
        0x84,
        0x7A,
        0xBD,
        0xCA,
        0x94,
        0xDF,
        0xD7,
        0xA8,
        0xB9,
        0x83,
        0x32,
        0x54,
        0x83,
        0x3D,
        0xB9,
        0x1C,
        0x19,
        0x51,
        0xB8,
        0x0E,
        0x99,
        0x1E,
        0xB0,
        0x44,
        0x69,
        0x20,
        0xA8,
        0x62,
        0x3D,
        0xA8,
        0xAD,
        0x86,
        0xA6,
        0x57,
        0x97,
        0xAA,
        0x30,
        0x20,
        0xE1,
        0x6B,
        0x05,
        0xBA,
        0x5E,
        0xD6,
        0x19,
        0x4F,
        0xEC,
        0x14,
        0x91,
        0xA8,
        0xD9,
        0x2A,
        0x01,
        0xD1,
        0x71,
        0xF7,
        0x3C,
        0x05,
        0x94,
        0x4F,
        0xEA,
        0x00,
        0x07,
        0xF0,
        0x1A,
        0x23,
        0x61,
        0xA3,
        0x32,
        0xF9,
        0x5A,
        0x5E,
        0xE9,
        0x89,
        0xEC,
        0x5E,
        0x81,
        0x5C,
        0xD4,
        0xD6,
        0xE1,
        0x52,
        0x63,
        0x5D,
        0x68,
        0x46,
        0x5A,
        0x83,
        0x54,
        0x07,
        0xAE,
        0x79,
        0x20,
        0xDA,
        0x8A,
        0xE7,
        0xA2,
        0x7F,
        0xBF,
        0x4C,
        0xE6,
        0xF3,
        0x01,
        0x21,
        0xAB,
        0xFE,
        0x43,
        0xEB,
        0xC7,
        0x5C,
        0xB2,
        0xA3,
        0xA6,
        0x24,
        0x43,
        0xE8,
        0x5D,
        0x3E,
        0x12,
        0x2D,
        0x4B,
        0x0F,
        0x52,
        0x84,
        0xED,
        0x96,
        0x88,
        0xB1,
        0x08,
        0xDC,
        0x1F,
        0x94,
        0x55,
        0xF9,
        0xF0,
        0xE6,
        0x9E,
        0x20,
        0x86,
        0x8B,
        0x6F,
        0xCF,
        0x52,
        0x4C,
        0x95,
        0xAB,
        0x90,
        0xD3,
        0x82,
        0x8C,
        0xD4,
        0x06,
        0x9E,
        0xD8,
        0x47,
        0x55,
        0x0A,
        0x4C,
        0xBD,
        0x9D,
        0xC8,
        0x6A,
        0xFE,
        0x9F,
        0xF0,
        0xAD,
        0xC3,
        0xF0,
        0xA8,
        0x57,
        0x86,
        0xDA,
        0x5C,
        0x63,
        0x1F,
        0x0F,
        0x15,
        0xDE,
        0x01,
        0x81,
        0xC1,
        0x44,
        0x9B,
        0xFA,
        0x7D,
        0x8D,
        0xE2,
        0x14,
        0xF3,
        0xCD,
        0xAC,
        0x6E,
        0x95,
        0x51,
        0x3A,
        0x74,
        0x49,
        0x69,
        0xB9,
        0x88,
        0xF5,
        0xC2,
        0xC1,
        0x52,
        0xAD,
        0xE2,
        0x7B,
        0x1A,
        0x24,
        0xFA,
        0xA9,
        0x68,
        0x62,
        0x65,
        0x2C,
        0x0B,
        0xDA,
        0xE1,
        0x8E,
        0x70,
        0x1F,
        0xF9,
        0xC7,
    };
    unsigned char e[] = {
        0x01,
        0x00,
        0x01,
    };
    unsigned char d[] = {
        0x26,
        0xC2,
        0x76,
        0xA8,
        0xFA,
        0xBA,
        0x83,
        0x66,
        0x06,
        0xDD,
        0xEB,
        0x28,
        0xD1,
        0x47,
        0x30,
        0x79,
        0x4F,
        0xFB,
        0xE2,
        0x8C,
        0xEA,
        0x1A,
        0x8D,
        0xC5,
        0x0B,
        0x1F,
        0xF0,
        0x99,
        0x95,
        0x7A,
        0x5A,
        0x4B,
        0x4C,
        0xAB,
        0xE0,
        0x8A,
        0x37,
        0x5B,
        0x75,
        0x05,
        0xCB,
        0x53,
        0xEB,
        0x90,
        0x3A,
        0x5A,
        0x66,
        0xF2,
        0xB1,
        0x75,
        0xB3,
        0x74,
        0xC6,
        0x05,
        0x77,
        0xC0,
        0x35,
        0xDD,
        0x6C,
        0x17,
        0x86,
        0x21,
        0x42,
        0xDC,
        0x30,
        0x23,
        0x05,
        0x50,
        0x9B,
        0x0F,
        0xE7,
        0x56,
        0xD2,
        0x23,
        0xCD,
        0xF9,
        0x98,
        0x1A,
        0x46,
        0x79,
        0x45,
        0xD5,
        0xD5,
        0x03,
        0xDD,
        0x25,
        0x64,
        0xD0,
        0x55,
        0xB9,
        0x99,
        0x10,
        0x53,
        0x1D,
        0xD4,
        0x8D,
        0xAB,
        0x79,
        0x35,
        0x10,
        0x81,
        0x87,
        0xE3,
        0x89,
        0x89,
        0x80,
        0x36,
        0xD9,
        0x5D,
        0x6E,
        0xB2,
        0xFD,
        0x61,
        0xF2,
        0x48,
        0xE0,
        0x90,
        0x49,
        0x61,
        0x6A,
        0x3F,
        0x81,
        0x44,
        0xC6,
        0x5B,
        0x0B,
        0xB3,
        0x60,
        0xCF,
        0xE4,
        0x56,
        0x18,
        0xCB,
        0x89,
        0x76,
        0xA8,
        0x67,
        0x35,
        0x0B,
        0xFD,
        0x4C,
        0xE8,
        0x8C,
        0xF6,
        0x29,
        0x6F,
        0x8F,
        0xCE,
        0xDC,
        0x6A,
        0x56,
        0x43,
        0x81,
        0x90,
        0x9F,
        0xA7,
        0xBA,
        0xDC,
        0xD9,
        0xCB,
        0x14,
        0x0E,
        0x01,
        0xAE,
        0x44,
        0x53,
        0x62,
        0xEC,
        0x68,
        0x9F,
        0x10,
        0x3C,
        0x7C,
        0xD4,
        0xD9,
        0x21,
        0x26,
        0x29,
        0xB8,
        0x50,
        0xB0,
        0x57,
        0xB2,
        0xF8,
        0x17,
        0x83,
        0x9E,
        0x12,
        0xCE,
        0xC3,
        0x37,
        0x05,
        0xC0,
        0xFB,
        0xD9,
        0x55,
        0x55,
        0xB3,
        0x8E,
        0x89,
        0x09,
        0x03,
        0x1A,
        0x67,
        0x05,
        0x52,
        0xAF,
        0xE1,
        0x09,
        0x6C,
        0x95,
        0x4A,
        0x29,
        0xC5,
        0x27,
        0x98,
        0xDE,
        0x5B,
        0xFF,
        0x5A,
        0x46,
        0x1F,
        0x7B,
        0x13,
        0x2A,
        0x8E,
        0x42,
        0x2B,
        0xB2,
        0x83,
        0x99,
        0x8D,
        0x74,
        0x8B,
        0x50,
        0xA8,
        0x63,
        0xBA,
        0x2A,
        0x78,
        0xB7,
        0xBC,
        0xE9,
        0x41,
        0x05,
        0xF8,
        0x2C,
        0xA9,
        0x9B,
        0x6E,
        0xED,
        0xC8,
        0x1E,
        0xAE,
        0x57,
        0x99,
    };
    unsigned char in[256] = {0x01, 0x01}, out[256];
    unsigned int mod_bitLen = 2048, exp_bitLen = 17;
    unsigned int mod_byteLen = get_byte_len(mod_bitLen), exp_byteLen = get_byte_len(exp_bitLen);

    print_buf_u8(e, exp_byteLen, "e");
    print_buf_u8(d, mod_byteLen, "d");
    print_buf_u8(n, mod_byteLen, "n");
    print_buf_u8(in, mod_byteLen, "in");
    pke_modexp_u8(n, e, in, out, mod_bitLen, exp_bitLen, 1);
    print_buf_u8(out, mod_byteLen, "out");
    pke_modexp_u8(n, d, out, out, mod_bitLen, mod_bitLen, 1);
    print_buf_u8(out, mod_byteLen, "out");
}

/**
 * @brief           Another test function for RSA operations
 */
void test001(void)
{
    unsigned char n[] = {
        0x02,
        0xAB,
        0x4F,
        0xE8,
        0xA9,
        0xF6,
        0x91,
        0xD6,
        0x0A,
        0x38,
        0x6B,
        0x26,
        0xE5,
        0xF2,
        0xC8,
        0xC9,
        0x10,
        0xF5,
        0x0B,
        0xF0,
        0x96,
        0x47,
        0x69,
        0x07,
        0x42,
        0x57,
        0x50,
        0x64,
        0x05,
        0x8F,
        0x11,
        0xB4,
        0xAB,
        0xAA,
        0xBF,
        0xEA,
        0x04,
        0x77,
        0x23,
        0xDB,
        0xE0,
        0x55,
        0x21,
        0x79,
        0xFE,
        0x16,
        0xB4,
        0x1E,
        0xEC,
        0x86,
        0xF6,
        0x1B,
        0x99,
        0x44,
        0xF6,
        0xBE,
        0xAC,
        0x82,
        0xCA,
        0xA2,
        0x36,
        0x15,
        0xCD,
        0x11,
        0xB7,
        0x86,
        0xC2,
        0x79,
        0x53,
        0xF2,
        0x36,
        0x73,
        0x56,
        0x02,
        0xBF,
        0x4C,
        0xD1,
        0xB2,
        0x60,
        0x6F,
        0x7B,
        0xCE,
        0x71,
        0x89,
        0xA6,
        0x2F,
        0x90,
        0x0B,
        0xED,
        0x79,
        0xCA,
        0xA9,
        0x99,
        0x72,
        0x66,
        0xE6,
        0x61,
        0x64,
        0x6B,
        0x8E,
        0x5E,
        0x29,
        0xBD,
        0xFC,
        0x0F,
        0xC9,
        0x8C,
        0xFB,
        0x9A,
        0x68,
        0x8D,
        0x50,
        0x60,
        0xFF,
        0x44,
        0xAD,
        0x2A,
        0xC2,
        0x54,
        0x51,
        0x60,
        0xEE,
        0x91,
        0xC5,
        0x52,
        0x47,
        0x5A,
        0x9F,
        0x23,
        0xDE,
        0x8B,
        0xE2,
        0x3B,
        0x16,
        0xFD,
        0xAC,
        0x65,
        0xF6,
        0x05,
        0x57,
        0xB8,
        0x2A,
        0xA3,
        0x7E,
        0x53,
        0x23,
        0x1A,
        0x2B,
        0x1A,
        0xB3,
        0xCC,
        0x09,
        0x4B,
        0xA4,
        0x46,
        0xE3,
        0x16,
        0xF3,
        0x7D,
        0x3D,
        0x75,
        0x11,
        0x7F,
        0xAE,
        0x66,
        0x6D,
        0x75,
        0xFB,
        0xBC,
        0x3E,
        0xFB,
        0x5B,
        0x27,
        0xA0,
        0x5A,
        0xB1,
        0xB4,
        0x0E,
        0x56,
        0xB4,
        0x4F,
        0x78,
        0xBA,
        0xF2,
        0xDE,
        0x60,
        0x7C,
        0x0B,
        0x9D,
        0x6A,
        0x71,
        0x12,
        0x4D,
        0xCE,
        0x47,
        0xCA,
        0x45,
        0xC4,
        0x1F,
        0xDF,
        0x87,
        0x35,
        0x62,
        0xE5,
        0x5C,
        0x1C,
        0x99,
        0xBA,
        0x6C,
        0x3E,
        0xE8,
        0x3E,
        0x5F,
        0x19,
        0x75,
        0x84,
        0x90,
        0x33,
        0xFE,
        0xC8,
        0x20,
        0x05,
        0x13,
        0xEF,
        0xA3,
        0x3B,
        0x99,
        0x30,
        0xE6,
        0x86,
        0xE7,
        0x11,
        0xD4,
        0x96,
        0xA3,
        0x64,
        0x78,
        0xBC,
        0x7B,
        0x73,
        0xB2,
        0x11,
        0xDD,
        0xBD,
        0x40,
        0x1A,
        0xCE,
        0x04,
        0x78,
        0xBA,
        0xB2,
        0xAA,
        0x75,
        0xDE,
        0x41,
        0x0C,
        0xF3,
    };
    unsigned char e[] = {
        0x01,
        0x00,
        0x01,
    };
    unsigned char d[] = {
        0x00,
        0x1E,
        0xA9,
        0xF6,
        0x59,
        0xF2,
        0x3B,
        0xB7,
        0x2C,
        0x3C,
        0x3D,
        0xEA,
        0xBF,
        0xF4,
        0xF6,
        0x37,
        0xB7,
        0xB0,
        0x17,
        0x7A,
        0x13,
        0x74,
        0x5E,
        0xED,
        0x39,
        0x77,
        0xEB,
        0x9E,
        0xA1,
        0x75,
        0x3B,
        0x29,
        0x2D,
        0x6E,
        0xFB,
        0x2F,
        0xC8,
        0x45,
        0x84,
        0x71,
        0x70,
        0x8E,
        0xC1,
        0x72,
        0xD5,
        0x09,
        0x35,
        0xCA,
        0x11,
        0x79,
        0x39,
        0x00,
        0x22,
        0x0F,
        0xAB,
        0x37,
        0x01,
        0x4C,
        0xD9,
        0x45,
        0x10,
        0x42,
        0x48,
        0x32,
        0x9C,
        0x56,
        0xCA,
        0xD1,
        0x61,
        0x08,
        0x04,
        0x93,
        0x86,
        0x6F,
        0x97,
        0x20,
        0x1E,
        0x64,
        0xEF,
        0xD8,
        0xF0,
        0xE8,
        0x61,
        0xC5,
        0xF8,
        0x94,
        0x37,
        0xD5,
        0xA1,
        0x31,
        0x8E,
        0xFB,
        0xAF,
        0x6C,
        0x27,
        0xDB,
        0xFC,
        0xD0,
        0xE1,
        0xD6,
        0xC0,
        0xB9,
        0x04,
        0xD2,
        0x93,
        0xEE,
        0xCA,
        0x89,
        0xDB,
        0xF3,
        0x07,
        0x2C,
        0x6D,
        0x3D,
        0xE7,
        0x5A,
        0x12,
        0x0A,
        0x28,
        0x78,
        0x82,
        0x6E,
        0x12,
        0x52,
        0x95,
        0x8F,
        0xA8,
        0x2C,
        0x6D,
        0xED,
        0x08,
        0x2E,
        0x96,
        0x2C,
        0x2A,
        0xCB,
        0x98,
        0xA3,
        0x59,
        0x72,
        0x8A,
        0x8D,
        0x3F,
        0x61,
        0x28,
        0xF5,
        0xAF,
        0xE0,
        0xE2,
        0x25,
        0x22,
        0xD1,
        0xE2,
        0x24,
        0x68,
        0xE6,
        0xFA,
        0x0F,
        0x6F,
        0x2E,
        0x90,
        0xD9,
        0x5D,
        0xDB,
        0x66,
        0x95,
        0x7C,
        0xA4,
        0x2F,
        0x9A,
        0xD6,
        0x66,
        0x6A,
        0x06,
        0x54,
        0x44,
        0xE4,
        0x6E,
        0x54,
        0xF1,
        0xC9,
        0x9E,
        0x73,
        0x0A,
        0xA0,
        0xAA,
        0x83,
        0x08,
        0x5A,
        0x07,
        0x89,
        0xD8,
        0x52,
        0x4A,
        0x88,
        0xDD,
        0xA6,
        0xD3,
        0x9E,
        0x35,
        0x16,
        0x7B,
        0x2A,
        0x56,
        0x14,
        0xEA,
        0xED,
        0x5A,
        0xB5,
        0x64,
        0x40,
        0x42,
        0x13,
        0xD7,
        0xB7,
        0x53,
        0xFA,
        0x34,
        0xB8,
        0xD2,
        0xDB,
        0x91,
        0x4C,
        0xD2,
        0xF8,
        0x23,
        0x80,
        0x02,
        0xDB,
        0xBF,
        0x76,
        0xAF,
        0x7B,
        0xF8,
        0x86,
        0x1F,
        0x8B,
        0xD7,
        0xC9,
        0x59,
        0x2C,
        0x0E,
        0xEE,
        0x53,
        0x75,
        0x1F,
        0xE7,
        0xA3,
        0xB4,
        0xA3,
        0xFD,
        0x9D,
        0x92,
        0x7D,
        0xEC,
        0xE9,
        0x81,
    };
    unsigned char in[256 + 1] = {0x01, 0x01}, out[256 + 1];
    unsigned int mod_bitLen = 2050, exp_bitLen = 17;
    unsigned int mod_byteLen = get_byte_len(mod_bitLen), exp_byteLen = get_byte_len(exp_bitLen);

    print_buf_u8(e, exp_byteLen, "e");
    print_buf_u8(d, mod_byteLen, "d");
    print_buf_u8(n, mod_byteLen, "n");
    print_buf_u8(in, mod_byteLen, "in");
    pke_modexp_u8(n, e, in, out, mod_bitLen, exp_bitLen, 1);
    print_buf_u8(out, mod_byteLen, "out");
    pke_modexp_u8(n, d, out, out, mod_bitLen, mod_bitLen, 1);
    print_buf_u8(out, mod_byteLen, "out");
}

#endif
